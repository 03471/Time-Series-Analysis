---
title: "Course Project"
author: ""
date: "December 10, 2017"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Project Description
NREL's Solar Power Data for Integration Studies are synthetic solar photovoltaic (PV) power plant data points for the United States representing the year 2006.
The data are intended for use by energy professionals—such as transmission planners, utility planners, project developers, and university researchers—who perform solar integration studies and need to estimate power production from hypothetical solar plants.

data source <https://www.nrel.gov/grid/assets/downloads/tx-east-pv-2006.zip>.

##Data Methodologies
The Solar Power Data for Integration Studies consist of 1 year (2006) of 5-minute solar power and hourly day-ahead forecasts for approximately 6,000 simulated PV plants. Solar power plant locations were determined based on the capacity expansion plan for high-penetration renewables in Phase 2 of the Western Wind and Solar Integration Study and the Eastern Renewable Generation Integration Study.

NREL generated the 5-minute data set using the Sub-Hour Irradiance Algorithm. The day-ahead solar forecast data for locations in the western United States were generated by 3TIER based on numerical weather predication simulations for Phase 1 of the Western Wind and Solar Integration Study. NREL generated the day-ahead solar forecast data in eastern U.S. locations using the Weather Research and Forecasting model.

The data are for specific years and should not be assumed to be representative of typical radiation levels for a site. These data should not generally be used for site-specific project development work.

##Naming Convention
The naming convention of the state-wise solar power data (.csv files) from the Solar Integration Studies is as follows.

Data Type_Latitude_Longitude_Weather Year_PV Type_CapacityMW_Time Interval _Min.csv

* Data Type
+ Actual: Real power output
+ DA: Day ahead forecast
+ HA4: 4 hour ahead forecast
* Weather Year: The PV data is based on the particular year's known weather condition.
* PV Type
+ UPV: Utility scale PV
+ DPV: Distributed PV
 Note: The practical difference between UPV and DPV is in the      configurations (UPV has single axis tracking while DPV is fixed tilt equaling to latitude) and the smoothing (both are run through a low-pass filter, the DPV will have more of the high frequency variability smoothed out).

* Capacity: Installed capacity in MW
* Time Interval: PV generation data reading interval in minutes.

##Goals and Future Works
1. Convert raw data to time series data. In real world application this is a secondary challange a data analyst encounters before developing a model
2. Resample the data to approximate on a feasible model
3. Develop forecast models with the techniques taught in course
4. Apply a prediction and validate with actual result
5. Observe additional tune and methods to improve validity

###including libraries
```{r library, echo=FALSE, warning=FALSE}
packages <- c('xts','astsa', 'forecast','rstudioapi','pander')
if (length(setdiff(packages, rownames(installed.packages()))) > 0) {
  install.packages(setdiff(packages, rownames(installed.packages())), dependencies = TRUE)  
}

for(package in packages){
  require(package, character.only = TRUE)
}
```
###including necessary components
```{r table3.1, echo=TRUE}
#Table 3.1. Behavior of the ACF and PACF for ARMA models
table.3.1 <- c("","AR(p)","MA(q)","ARMA(p,q)")
table.3.1 <- rbind(table.3.1,c("ACF","Tails off","Cuts off after lag q","Tails off"))
table.3.1 <- rbind(table.3.1,c("PACF","Cuts off after lag p","Tails off q","Tails off"))
pandoc.table(table.3.1)
```

###assing formatted data and col names
```{r s1, echo=FALSE}
data.raw <- read.csv("D:\\Google Drive\\masters\\MSDA\\STAT5307-Time Series Analysis\\project\\tx-east-pv-2006\\DA_35.35_-101.85_2006_DPV_28MW_60_Min.csv", header = TRUE)
data.raw.formatted <- data.frame(c(strptime(data.raw$LocalTime, "%m/%d/%y %H:%M")), c(as.double(data.raw$Power.MW.)))
colnames(data.raw.formatted) <- c("TimeStamp","Power.MW")
```
###aggregate
```{r s2, echo=TRUE}
data.daily <- aggregate(data.raw.formatted$Power.MW, list(hour=cut(data.raw.formatted$TimeStamp,"day")), sum)
data.daily.train <- data.daily[1:90,]
data.daily.test <- data.daily[91:97,]
```

###create training and validation subsets
```{r s3, echo=TRUE}
data.daily.train <- data.daily[1:90,]
data.daily.test <- data.daily[91:97,]

colnames(data.daily.train) <- c("TimeStamp","Power.MW")
names(data.daily.train)

min(as.Date(data.daily.train$TimeStamp))
max(as.Date(data.daily.train$TimeStamp))

data.daily.train.formatted <- data.frame(as.Date(data.daily.train$TimeStamp),as.double(data.daily.train$Power.MW))
colnames(data.daily.train.formatted) <- c("TimeStamp","Power.MW")
```
###create ts data
```{r s4, echo=TRUE}
data.daily.train.ts <- ts(data.daily.train.formatted$Power.MW,start=c(2006,60),frequency=365)
```
###plot acf
```{r s5, echo=TRUE}
plot(data.daily.train.ts, col="blue")
grid(col = "lightgray", lty = "dotted", lwd = par("lwd"), equilogs = TRUE)
acf2(data.daily.train.ts)
#ACF cuts off PACF tails off
```

###apply auto arima
```{r s6, echo=TRUE}
auto.arima(data.daily.train.ts)
sarima(data.daily.train.ts, 1, 1, 1)  
```
###ARMA(1,1)

##FORECAST
###option-1
```{r s7, echo=TRUE}
sarima.forecast <- sarima.for(data.daily.train.ts, 7,1,1,1)

data.daily.fit = arima(data.daily.train.ts, order=c(1,1,1))
tsdiag(data.daily.fit, gof.lag=30) 
```

###option-2
```{r s8, echo=TRUE}
data.daily.pr = predict(data.daily.fit, n.ahead=7)  # forecasts
data.daily.pr$pred

U = data.daily.pr$pred + 1.96*data.daily.pr$se
L = data.daily.pr$pred - 1.96*data.daily.pr$se

minx = min(data.daily.train.ts,L) 
maxx = max(data.daily.train.ts,U)

ts.plot(data.daily.train.ts, col="gray",xlim=c(2006.30,2006.45), data.daily.pr$pred, ylim=c(minx,maxx), main="TX-2006 Solar Power Plant Production Forecast") 
lines(data.daily.pr$pred, col="red", type="o")
grid(col = "lightgray", lty = "dotted", lwd = par("lwd"), equilogs = TRUE)
lines(U, col="blue", lty="dashed")
lines(L, col="blue", lty="dashed")
```

###validation
```{r s9, echo=TRUE}
ylim.min <- min(data.daily.test[,2],c(data.daily.pr$pred))-5
ylim.max <- max(data.daily.test[,2],c(data.daily.pr$pred))+5
plot(data.daily.test[,2],ylim=c(ylim.min, ylim.max), col="red", pch = 15, main="TX-2006 Solar Power Plant Production Forecast Comparison", ylab = "Power (MW)", xlab = "Predicted days")
text(x=1:7, y=data.daily.test[,2]+3,cex =.7, offset = 3, labels=data.daily.test[,2], col="red") 
axis(side=1, at=c(1:7))
points(c(data.daily.pr$pred), col="blue", pch = 16)
text(x=1:7, y=c(data.daily.pr$pred)+3,cex =.7, offset = 3, labels=c(round(data.daily.pr$pred,2)), col="blue") 
grid(col = "lightgray", lty = "dotted", lwd = par("lwd"), equilogs = TRUE)
```



##Conclusion and Results
1. Hourly data didnt work as expected. 
2. Daily aggregatred data is non seasonal and ARMA(1,1) model is feasible
3. Residuals are correlated and p-values > .05 
4. Prediction outputs found in expected range when compred with validation data
